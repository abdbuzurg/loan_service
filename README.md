# üöó Loan Service

**Loan Service** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è, —Ä–∞—Å—á—ë—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–Ω—ã–º–∏ –∏ –ª–∏–∑–∏–Ω–≥–æ–≤—ã–º–∏ –∑–∞—è–≤–∫–∞–º–∏.  
–°–µ—Ä–≤–∏—Å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ **gRPC API**.

–û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤:

- –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç—ã  
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã  

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- `CreateApplication` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∑–∞—è–≤–∫–∏  
- `Calculate` ‚Äî —Ä–∞—Å—á—ë—Ç —Å—É–º–º—ã –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –∏ —Å—Ç–∞–≤–∫–∏  
- `GetApplication` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞—è–≤–∫–µ  
- `ListApplications` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫ –∫–ª–∏–µ–Ω—Ç–∞  
- `GetLoan` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ –∫—Ä–µ–¥–∏—Ç–∞  
- `ListLoan` ‚Äî c–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤  
- `ListVehicles` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏–∑ Koinot Auto  
- PostgreSQL ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö  
- SQLC ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  

---

# üß© –ú–µ—Ç–æ–¥: CreateApplication

## üìò –û–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∫—Ä–µ–¥–∏—Ç–Ω—É—é –∑–∞—è–≤–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.  
–ù–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ ‚Äî **PENDING**.

## üì• –ó–∞–ø—Ä–æ—Å (`CreateApplicationRequest`)

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|------------|----------|
| `user_id` | int64 | ‚úÖ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `type` | string | ‚úÖ | –¢–∏–ø –∑–∞—è–≤–∫–∏ (`auto`, `personal`) |
| `vehicle_vin` | string | ‚ùå | VIN a–≤—Ç–æ–º–æ–±–∏–ª—è |
| `vehicle_name` | string | ‚ùå | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è |
| `currency_code` | string | ‚úÖ | –í–∞–ª—é—Ç–∞  |
| `price` | int64 | ‚úÖ | –¶–µ–Ω–∞ –∑–∞—è–≤–∫–∏ |
| `down_payment` | int64 | ‚úÖ | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å –∑–∞—è–≤–∫–∏ |
| `net_price` | int64 | ‚úÖ | –ß–∏—Å—Ç–∞—è —Ü–µ–Ω–∞ –∑–∞—è–≤–∫–∏ |
| `margin_rate` | double | ‚úÖ | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ |
| `term_months` | double | ‚úÖ | –°—Ä–æ–∫ –∑–∞—è–≤–∫–∏ –∫—Ä–µ–¥–∏—Ç–∞ |
| `monthly_payment` | double | ‚úÖ | –ú–µ—Å—è—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∑–∞ –∫—Ä–µ–¥–∏—Ç |

## üì§ –û—Ç–≤–µ—Ç (`CreateApplicationResponse`)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| `application`| LoanApplication | –ó–∞—è–≤–∫–∞ |
| `loan_service_error` | LoanServiceError | –°—Ç–∞—Ç—É—Å (`PENDING`) |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ LoanApplication 
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| `id` | int64 | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `user_id` | int64  | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `type` | string | –¢–∏–ø –∑–∞—è–≤–∫–∏ (`auto`, `personal`) |
| `vehicle_vin` | string  | VIN a–≤—Ç–æ–º–æ–±–∏–ª—è |
| `vehicle_name` | string  | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è |
| `currency_code` | string  | –í–∞–ª—é—Ç–∞  |
| `price` | int64 | –¶–µ–Ω–∞ –∑–∞—è–≤–∫–∏ |
| `down_payment` | int64  | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å –∑–∞—è–≤–∫–∏ |
| `net_price` | int64 | –ß–∏—Å—Ç–∞—è —Ü–µ–Ω–∞ –∑–∞—è–≤–∫–∏ |
| `margin_rate` | double | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ |
| `term_months` | double | –°—Ä–æ–∫ –∑–∞—è–≤–∫–∏ –∫—Ä–µ–¥–∏—Ç–∞ |
| `monthly_payment` | double | –ú–µ—Å—è—á–Ω–∞ –æ–ø–ª–∞—Ç–∞ –∑–∞ –∫—Ä–µ–¥–∏—Ç
| `created_at` | string | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
| `updated_at` | string | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ LoanServiceError
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| `code` | int32 | –ö–æ–¥ –æ—à–∏–±–∫–∏ |
| `description` | string | –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ |

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "user_id": "b1d9d9e2-30c1-4fc2-bd6c-5404b9c918b0",
  "type": "auto",
  "vehicle_vin": "4Y1SL65848Z411439",
  "vehicle_name": "BYD E2",
  "currency_code": "TJS",
  "price": 45000,
  "down_payment": 10000,
  "term_months": 36,
  "margin_rate": 0.12,
  "net_price": 80000,
  "monthly_payment": 2222,
}
```

## –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
```json
{
  "application": {
    "id": 1,
    "user_id": "b1d9d9e2-30c1-4fc2-bd6c-5404b9c918b0",
    "type": "auto",
    "vehicle_vin": "4Y1SL65848Z411439",
    "vehicle_name": "BYD E2",
    "currency_code": "TJS",
    "price": 45000,
    "down_payment": 10000,
    "term_months": 36,
    "margin_rate": 0.12,
    "net_price": 80000,
    "monthly_payment": 2222,
    "created_at": "2023-12-31T15:59:60Z",
    "updated_at": "2023-12-31T15:59:60Z",
  },
  "loan_server_error": {
    "code": 0,
    "description": "",
  }
}

```

## üö´ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
| –ö–æ–¥ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| `id` | int64 | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

# üìÑ –ú–µ—Ç–æ–¥: GetApplication

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∑–∞—è–≤–∫–µ.

## üì• –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "application_id": "e26bd40f-ea13-498d-a3dd-750be345b788"
}
```

## üì§ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "application_id": "e26bd40f-ea13-498d-a3dd-750be345b788",
  "client_id": "b1d9d9e2-30c1-4fc2-bd6c-5404b9c918b0",
  "application_type": "auto",
  "amount": 45000,
  "term_months": 36,
  "monthly_payment": 1550.75,
  "interest_rate": 22.5,
  "status": "PENDING",
  "vehicle_info": {
    "brand": "Toyota",
    "model": "Corolla",
    "year": 2019,
    "vin": "JTDBR32E720123456"
  },
  "created_at": "2025-01-08T10:23:54Z"
}
```

---

# üìä –ú–µ—Ç–æ–¥: CalculateLoan

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–µ–¥–∏—Ç–∞ (–ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É, –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –∏ –æ–±—â—É—é —Å—É–º–º—É –≤—ã–ø–ª–∞—Ç).

## üì• –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "amount": 30000,
  "term_months": 24,
  "application_type": "personal"
}
```

## üì§ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "monthly_payment": 1487.32,
  "interest_rate": 25.5,
  "total_payment": 35695.68
}
```

---

# üìã –ú–µ—Ç–æ–¥: ListApplications

–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

## üì• –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "client_id": "b1d9d9e2-30c1-4fc2-bd6c-5404b9c918b0"
}
```

## üì§ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "applications": [
    {
      "application_id": "e26bd40f-ea13-498d-a3dd-750be345b788",
      "application_type": "auto",
      "amount": 45000,
      "status": "APPROVED",
      "created_at": "2025-01-08T10:23:54Z"
    },
    {
      "application_id": "91cd0117-3ad2-4bb0-839d-927d324f3df7",
      "application_type": "personal",
      "amount": 12000,
      "status": "PENDING",
      "created_at": "2025-01-18T09:05:32Z"
    }
  ]
}
```

---

# üîÑ –ú–µ—Ç–æ–¥: ChangeStatus

–ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∑–∞—è–≤–∫–∏.

### –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

- `PENDING`
- `APPROVED`
- `REJECTED`
- `CANCELLED`

## üì• –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "application_id": "e26bd40f-ea13-498d-a3dd-750be345b788",
  "status": "APPROVED"
}
```

## üì§ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "status": "APPROVED",
  "message": "Status updated successfully"
}
```

---

# ‚ö†Ô∏è –û—à–∏–±–∫–∏

| –ö–æ–¥ gRPC | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `InvalidArgument` | –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ |
| `NotFound` | –ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ |
| `Internal` | –°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞ |

---

# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **gRPC** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è  
- **PostgreSQL** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö  
- **SQLC** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤  
- **Clean Architecture** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ handler, service, repository  

---

# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
make test
```

---

# üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
make run
```

---

# üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-----------|
| `DB_HOST` | –•–æ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `DB_PASS` | –ü–∞—Ä–æ–ª—å |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |

---

# üîó –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

üëâ https://github.com/abdbuzurg/loan_service
